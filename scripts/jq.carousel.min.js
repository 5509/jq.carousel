/*!
 * jq.carousel
 * Simple and customizable carousel
 *
 * @version      2.42
 * @author       nori (norimania@gmail.com)
 * @copyright    5509 (http://5509.me/)
 * @license      The MIT License
 * @link         https://github.com/5509/jq.carousel
 *
 * 2012-03-13 16:29
 */(function(a,b){function e(a,c){var d=0,e=b;/^\d+$/.test(a)&&(a=new Array(a));e=a.length;for(;d<e;d+=1)c.apply(a[d],[d].concat(arguments))}var c=function(a,b){this.namespace="Carousel";return this instanceof c?this.init(a,b):new c(a,b)};c.prototype={init:function(b,c){var d=this;d.conf=a.extend({vertical:!1,loop:!0,easing:"swing",start:1,group:1,duration:.2,indicator:!1},c);d.$elem=b;d.$carousel_wrap=a("<div></div>");d._build();d._setIndicator();d._eventify();return d},_build:function(){var b=this,c=b.conf,d=0,f=0;b.offset_prop=b.conf.vertical?"offsetHeight":"offsetWidth";b.float=c.vertical?"none":"left";b.position=c.vertical?"top":"left";b.prop=c.vertical?"height":"width";b.view_size=b.$elem[0][b.offset_prop];b.total_size=0;b.current=c.start;b.$items=b.$elem.children();b.$items_original=b.$items.clone();b.items_length=b.$items.length;b.items_len_hidden=0;b.$elem.html(b.$carousel_wrap.html(b.$items));f=b.items_length*b.$items[0][b.offset_prop];b.$items.css({"float":b.float});e(b.$items,function(c){var d=this;d.carousel_id=c;d.$elem=a(this);d.data_size=d[b.offset_prop];d.orig_size=d.$elem.css(b.prop);if(b.items_len_hidden>b.view_size)return;b.items_len_hidden=b.items_len_hidden+d.data_size});b.item_size=b.$items.eq(0)[0].data_size;b.items_len_hidden=b.items_len_hidden/b.item_size;if(c.group!==1){b._groupSetup();c.loop&&b._cloneGroup()}else c.loop&&b._cloneItem();b.$elem.css({overflow:"hidden",position:"relative"});if(c.loop){d=b.items_len_hidden+b.current-1;b.current_pos=-d*b.item_size;b.default_pos=-b.items_len_hidden*b.item_size}else{d=b.items_length<c.start?1:c.start;b.current_pos=0;b.default_pos=0}b.$carousel_wrap.css({position:"relative"}).css(b.position,b.current_pos);b.vertical?b.$carousel_wrap.css("width",b.$items.eq(0)[0].offsetWidth):b.$carousel_wrap.css("height",b.$items.eq(0)[0].offsetHeight);b.max_point=b.default_pos-b.item_size*b.items_length;b.min_point=b.default_pos;b.move_size=b.item_size;c.group===1?b.$items=b.$carousel_wrap.children():b.$items=b.$carousel_wrap.find(".carousel_group_inner");b._setSize();b.$elem.trigger("carousel.ready")},_eventify:function(){var a=this,c=a.conf,d=b;if(!c.indicator)return;d=a.$indicator.data("indicator");a.$elem.bind({"Carousel.prev":function(){d.active()},"Carousel.next":function(){d.active()}})},_groupSetup:function(){var b=this,c=0,d=0,e=b.items_length,f=b.conf,g=e/f.group,h=Math.ceil(g),i=new Array(h),j=b.item_size*f.group;for(;c<e;c++){c!==0&&c%f.group===0&&(d+=1);if(!i[d]){i[d]=a('<div class="carousel_group_inner"></div>');i[d].css("float",b.float).css(b.prop,j)}i[d].append(b.$items.eq(c))}for(c=0;c<h;c++)b.$carousel_wrap.append(i[c]);b.$items=b.$carousel_wrap.find(".carousel_group_inner");b.items_length=b.$items.length;b.items_len_hidden=1;b.item_size=b.item_size*f.group},_cloneItem:function(){var b=this,c=b.items_len_hidden,d=function(b,c){var d,e=this,f=[];for(d=0;d<c;d++){if(d===c)break;f.push(e.eq(b!=="<"?e.length-(1+d):d).clone())}return a(f)},f=function(){var b=[];a.each(this,function(a,c){b.unshift(c.clone())});return a(b)},g=f.call(d.call(b.$items,"<",c)),h=f.call(d.call(b.$items,">",c));e(g,function(){b.$items.eq(b.$items.length-1).after(this)});e(h,function(){b.$items.eq(0).before(this)})},_cloneGroup:function(){var a=this,b=a.items_len_hidden,c=a.$items.eq(0).clone(),d=a.$items.eq(a.items_length-1).clone();a.$items.eq(0).before(d);a.$items.eq(a.$items.length-1).after(c)},_getSize:function(a){var c=this,d=b;c.conf.group===1?d=c.$carousel_wrap.children():d=c.$elem.find(".carousel_group_inner");c.total_size=0;e(d,function(a){var b=this;b.data_size=b[c.offset_prop];c.total_size=c.total_size+b.data_size})},_setSize:function(){var a=this;a._getSize();a.$carousel_wrap.css(a.prop,a.total_size)},_moveState:function(){var a=this,b=a.view_size,c=a.items_length*a.item_size;return c<=b?!1:a.current===a.items_length?"max":a.current===1?"min":!0},_getNext:function(a){var b=this,c=b.conf;a+1>b.items_length?a=1:a+=1;return a},_getPrev:function(a){var b=this,c=b.conf;a-1===0?a=b.items_length:a-=1;return a},_setCurrent:function(a){var c=this,d=b,e=c.current;a?d=c._getNext(e):d=c._getPrev(e);c.current=d},_toNext:function(){var a=this,b=a.conf,c=a.items_len_hidden,d={};if(!a.conf.loop&&a.current===a.items_length)return;a._setCurrent(!0);a.current_pos=a.current_pos-a.move_size;if(a.current_pos<a.max_point){a.$carousel_wrap.css(a.position,a.default_pos);a.current_pos=a.default_pos-a.move_size}d[a.position]=a.current_pos;a.$carousel_wrap.animate(d,{queue:!1,easing:b.easing,duration:b.duration*1e3,complete:function(){a.$elem.trigger("Carousel.next")}})},_toPrev:function(){var a=this,b=a.conf,c=a.items_len_hidden,d=a.items_length+c,e=a.item_size*a.items_length,f={};if(!a.conf.loop&&a.current===1)return;a._setCurrent(!1);a.current_pos=a.current_pos+a.move_size;if(a.default_pos<a.current_pos){a.$carousel_wrap.css(a.position,-a.item_size*d);a.current_pos=a.default_pos-e+a.move_size}f[a.position]=a.current_pos;a.$carousel_wrap.animate(f,{queue:!1,easing:b.easing,duration:b.duration*1e3,complete:function(){a.$elem.trigger("Carousel.prev")}})},_getIndicator:function(b){var c=this,e=d(c,b),f=a('<div class="carousel_indicator"></div>');f.data("indicator",e);f.append(e.$elems);return f},_setIndicator:function(a){var c=this,d=b;if(!c.conf.indicator)return;if(!c.$indicator){c.$indicator=c._getIndicator(a);c.$elem.after(c.$indicator)}else{d=c.$indicator.data("indicator");c.$indicator.append(d.refresh())}},_callAPI:function(a,b){var c=this;if(typeof c[a]!="function")throw a+" does not exist of Carousel methods.";if(/^_/.test(a)&&typeof c[a]=="function")throw"Method begins with an underscore are not exposed.";return c[a](b)},indicator:function(a){var b=this;return b._getIndicator(a)},getCurrent:function(){var a=this;return a.current-1},getMoveState:function(){var a=this;return a._moveState()},prev:function(){var a=this;a._toPrev();return a.$elem},next:function(){var a=this;a._toNext();return a.$elem},reset:function(b){var c=this;c.$elem.empty().append(c.$items_original);b&&(c.conf=a.extend(c.conf,b));c.$elem.trigger("Carousel.reset");return c.$elem},refresh:function(){var a=this;a.total_size=0;a._build();a._setIndicator();a.$elem.trigger("Carousel.refresh");return a.$elem}};var d=function(a,b){this.namespace="Indicator";return this instanceof d?this.init(a,b):new d(a,b)};d.prototype={init:function(a,b){var c=this;c.carousel=a;c._build(b)},_build:function(b){var c=this,d=c.carousel,e=d.getCurrent(),f=0,g=d.items_length,h="",i="";for(;f<g;f++){f===e?i=' class="active"':i="";h=h+"<span"+i+">";h+=b?f:"";h+="</span>"}c.$elems=a(h)},_setActive:function(){var a=this,b=a.carousel;a.$elems.removeClass("active");a.$elems.eq(b.getCurrent()).addClass("active")},refresh:function(){var a=this;a.$elems.remove();a._build();return a.$elems},active:function(){var a=this;a._setActive()}};jQuery.fn.carousel=function(a,b){var d=this.data("carousel");if(d)return d._callAPI(a,b);d=c(this,a);this.data("carousel",d);return this}})(jQuery);